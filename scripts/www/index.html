<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‹‰äº†å— A - ä½ çš„ä¸“å±æ‹‰å±è®°å½•ä»ª</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #8B4513;
            --secondary: #D2691E;
            --accent: #FFD700;
            --bg: #FDF5E6;
            --card-bg: #FFF8DC;
            --text: #5C4033;
            --light-text: #8B4513;
        }
        
        body {
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            padding: 20px;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23d2691e' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            color: white;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(139, 69, 19, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "ğŸ’©";
            position: absolute;
            font-size: 120px;
            opacity: 0.1;
            top: -20px;
            right: -20px;
            transform: rotate(30deg);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            font-style: italic;
        }
        
        .card {
            background-color: var(--card-bg);
            border-radius: 18px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(139, 69, 19, 0.1);
            border: 2px dashed var(--secondary);
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
        }
        
        .card-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .card-title i {
            font-size: 1.5rem;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0c9a6;
            border-radius: 10px;
            background-color: white;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(210, 105, 30, 0.2);
        }
        
        .options-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 10px;
        }
        
        .option-card {
            background: white;
            border: 2px solid #e0c9a6;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.95rem;
        }
        
        .option-card:hover {
            transform: translateY(-3px);
            border-color: var(--secondary);
            box-shadow: 0 5px 10px rgba(139, 69, 19, 0.1);
        }
        
        .option-card.selected {
            background-color: var(--secondary);
            color: white;
            border-color: var(--primary);
        }
        
        .option-card .emoji {
            font-size: 1.8rem;
            display: block;
            margin-bottom: 5px;
        }
        
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            color: white;
            box-shadow: 0 5px 15px rgba(139, 69, 19, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(139, 69, 19, 0.4);
        }
        
        .btn-secondary {
            background-color: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        
        .btn-secondary:hover {
            background-color: #f8f0e0;
        }
        
        .small-text {
            font-size: 0.85rem;
            color: var(--light-text);
            margin-top: 5px;
            font-style: italic;
        }
        
        .history-section {
            display: none;
        }
        
        .history-item {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 5px solid var(--secondary);
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-weight: bold;
            color: var(--primary);
        }
        
        .history-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            font-size: 0.9rem;
        }
        
        .history-detail {
            background: #f9f9f9;
            padding: 8px;
            border-radius: 8px;
            text-align: center;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--light-text);
            font-style: italic;
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }
        
        .ai-summary {
            background: linear-gradient(135deg, #f5f5f5, #e6e6e6);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border: 1px dashed var(--light-text);
            display: none;
        }
        
        .ai-summary h3 {
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .ai-summary p {
            margin-bottom: 10px;
            line-height: 1.7;
        }
        
        .ai-summary .recommendation {
            font-weight: bold;
            color: var(--primary);
            background: white;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .disclaimer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
            font-size: 0.85rem;
            color: #777;
            border: 1px dashed #ccc;
        }
        
        .navigation {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .nav-btn {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .nav-btn.active {
            background: var(--primary);
            color: white;
        }
        
        .nav-btn:not(.active) {
            background: white;
            color: var(--primary);
            border: 1px solid var(--primary);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transform: translateX(150%);
            transition: transform 0.4s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .options-container {
                grid-template-columns: 1fr;
            }
            
            .card {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ’© æ‹‰äº†å— A</h1>
            <div class="subtitle">äººå¯ä»¥emoï¼Œä½†å±ä¸èƒ½æ†‹</div>
        </header>
        
        <div class="navigation">
            <div class="nav-btn active" id="homeNav">é¦–é¡µè®°å½•</div>
            <div class="nav-btn" id="historyNav">å†å²å›å¿†</div>
        </div>
        
        <!-- é¦–é¡µè¡¨å• -->
        <div class="home-section">
            <!-- çµé­‚æ‹·é—® -->
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-question-circle"></i>
                    <span>ä»Šå¤©ï¼Œä½ æ‹‰äº†å—ï¼Ÿ</span>
                </div>
                <div class="options-container" id="statusOptions">
                    <div class="option-card" data-value="æ‹‰è¿‡äº†">
                        <span class="emoji">ğŸ’©</span>
                        æ‹‰è¿‡äº†
                    </div>
                    <div class="option-card" data-value="è¿˜åœ¨é…é…¿">
                        <span class="emoji">â³</span>
                        è¿˜åœ¨é…é…¿
                    </div>
                    <div class="option-card" data-value="å¿˜äº†">
                        <span class="emoji">ğŸ¤¡</span>
                        å¿˜äº†
                    </div>
                </div>
            </div>
            
            <!-- æ‹‰å±æ—¶é—´ -->
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-clock"></i>
                    <span>æ‹‰å±å¯åŠ¨æ—¶é—´</span>
                </div>
                <div class="input-group">
                    <input type="time" id="startTime" placeholder="æ¯”å¦‚ï¼š07:58ï¼ˆåˆšé†’å°±æ‹‰ï¼Œå±äºå¤©èµ‹å‹é€‰æ‰‹ï¼‰">
                    <div class="small-text">æ¯”å¦‚ï¼š07:58ï¼ˆåˆšé†’å°±æ‹‰ï¼Œå±äºå¤©èµ‹å‹é€‰æ‰‹ï¼‰</div>
                </div>
            </div>
            
            <!-- æ‹‰å±æ—¶é•¿ -->
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-hourglass-half"></i>
                    <span>æœ¬æ¬¡æ‹‰å±æ¶ˆè€—æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰</span>
                </div>
                <div class="input-group">
                    <input type="number" id="duration" min="1" max="120" placeholder="æ¯”å¦‚ï¼š3ï¼ˆæ•ˆç‡æ´¾ï¼‰ / 15ï¼ˆæ²‰æµ¸å¼ï¼‰">
                    <div class="small-text">æ¸©é¦¨æç¤ºï¼šè¶…è¿‡ 20 åˆ†é’Ÿå°†è‡ªåŠ¨è¿›å…¥â€œè…¿éº»æ¨¡å¼â€</div>
                </div>
            </div>
            
            <!-- æ‹‰å±å½¢çŠ¶ -->
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-toilet"></i>
                    <span>ä»Šæ—¥å±å†µæ±‡æŠ¥</span>
                </div>
                <div class="options-container" id="shapeOptions">
                    <div class="option-card" data-value="é¡ºæ»‘æˆå‹ï¼Œäººç”Ÿå·…å³°">
                        <span class="emoji">ğŸŸ¤</span>
                        é¡ºæ»‘æˆå‹
                    </div>
                    <div class="option-card" data-value="åç¡¬ï¼Œæœ‰ç‚¹è¾ƒåŠ²">
                        <span class="emoji">ğŸ§±</span>
                        åç¡¬è¾ƒåŠ²
                    </div>
                    <div class="option-card" data-value="ç¨€é‡Œå“—å•¦ï¼Œæ¥ä¸åŠå‘Šåˆ«">
                        <span class="emoji">ğŸ’¦</span>
                        ç¨€é‡Œå“—å•¦
                    </div>
                    <div class="option-card" data-value="çˆ†å‘è¾“å‡ºï¼Œæ¯«æ— ä¿ç•™">
                        <span class="emoji">ğŸ’¥</span>
                        çˆ†å‘è¾“å‡º
                    </div>
                    <div class="option-card" data-value="ä¸æƒ³å›å¿†">
                        <span class="emoji">ğŸ«¥</span>
                        ä¸æƒ³å›å¿†
                    </div>
                </div>
            </div>
            
            <!-- æ‹‰å±çœ¼ç¥ -->
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-eye"></i>
                    <span>æ‹‰å±å½“ä¸‹çš„çœ¼ç¥çŠ¶æ€</span>
                </div>
                <div class="options-container" id="eyeOptions">
                    <div class="option-card" data-value="æ”¾ç©ºï¼Œè„‘å­å…³æœº">
                        <span class="emoji">ğŸ˜Œ</span>
                        æ”¾ç©ºå…³æœº
                    </div>
                    <div class="option-card" data-value="å†·é™æ€è€ƒäººç”Ÿæ„ä¹‰">
                        <span class="emoji">ğŸ˜</span>
                        å“²å­¦æ€è€ƒ
                    </div>
                    <div class="option-card" data-value="ç”¨åŠ›ä½†ä¸è¯´">
                        <span class="emoji">ğŸ˜µ</span>
                        ç”¨åŠ›ä¸è¯´
                    </div>
                    <div class="option-card" data-value="çµé­‚çŸ­æš‚ç¦»ä½“">
                        <span class="emoji">ğŸ« </span>
                        çµé­‚å‡ºçª
                    </div>
                    <div class="option-card" data-value="çœ¼ç¥è­¦æƒ•ï¼ˆæ€•è¢«æ•²é—¨ï¼‰">
                        <span class="emoji">ğŸ‘ï¸</span>
                        è­¦æƒ•æ•²é—¨
                    </div>
                </div>
            </div>
            
            <!-- é¢å¤–ç¢ç¢å¿µ -->
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-comment-dots"></i>
                    <span>æœ¬æ¬¡æ‹‰å±è¡¥å……è¯´æ˜</span>
                </div>
                <div class="input-group">
                    <textarea id="notes" rows="3" placeholder="æ¯”å¦‚ï¼šæ˜¨å¤©çƒ§çƒ¤åƒå¤šäº† / å’–å•¡ä¸è®²æ­¦å¾· / è¿™æŠŠæ˜¯è¢«æ—©é¤èƒŒåˆºäº†"></textarea>
                </div>
            </div>
            
            <!-- æäº¤æŒ‰é’® -->
            <button class="btn btn-primary" id="submitBtn">
                <i class="fas fa-save"></i> å°±æ˜¯è¿™ä¸€æ‹‰ï¼Œç»™æˆ‘å­˜ä¸Š
            </button>
            
            <!-- AIæ€»ç»“ï¼ˆåˆå§‹éšè—ï¼‰ -->
            <div class="ai-summary" id="aiSummary">
                <h3><i class="fas fa-robot"></i> AI æ²™é›•æ€»ç»“</h3>
                <p id="aiSummaryContent">AI æ­£åœ¨åˆ†æä½ è¿‘æœŸçš„å±å†µèµ°åŠ¿â€¦â€¦</p>
            </div>
        </div>
        
        <!-- å†å²è®°å½•é¡µ -->
        <div class="history-section">
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-history"></i>
                    <span>ä½ çš„å±ç”Ÿå›å¿†å½•</span>
                </div>
                <div id="historyList">
                    <!-- å†å²è®°å½•å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div class="empty-state" id="emptyState">
                    <i class="fas fa-toilet"></i>
                    <p>è¿™é‡Œè¿˜å¾ˆå¹²å‡€<br>ç­‰ä½ ç¬¬ä¸€æ¬¡æ‹‰å®Œå†æ¥æ±¡æŸ“å®ƒå§</p>
                </div>
            </div>
            
            <button class="btn btn-secondary" id="clearHistoryBtn">
                <i class="fas fa-trash-alt"></i> æ¸…ç©ºæ‰€æœ‰å›å¿†
            </button>
        </div>
        
        <!-- å…è´£å£°æ˜ -->
        <div class="disclaimer">
            <p>æœ¬äº§å“ä¸å¯¹ä¾¿ç§˜ã€æ‹‰ç¨€ã€çˆ†æ‹‰è´Ÿè´£<br>ä½†ä¼šé™ªä½ è®°å½•æ¯ä¸€æ¬¡åŠªåŠ›</p>
        </div>
    </div>
    
    <!-- é€šçŸ¥ -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i> <span id="notificationText">è®°å½•æˆåŠŸï¼</span>
    </div>

    <script>
        // æ•°æ®å­˜å‚¨
        let records = JSON.parse(localStorage.getItem('laleRecords')) || [];
        
        // DOMå…ƒç´ 
        const homeSection = document.querySelector('.home-section');
        const historySection = document.querySelector('.history-section');
        const homeNav = document.getElementById('homeNav');
        const historyNav = document.getElementById('historyNav');
        const submitBtn = document.getElementById('submitBtn');
        const clearHistoryBtn = document.getElementById('clearHistoryBtn');
        const historyList = document.getElementById('historyList');
        const emptyState = document.getElementById('emptyState');
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notificationText');
        const aiSummary = document.getElementById('aiSummary');
        const aiSummaryContent = document.getElementById('aiSummaryContent');
        
        // è¡¨å•å­—æ®µ
        const startTime = document.getElementById('startTime');
        const duration = document.getElementById('duration');
        const notes = document.getElementById('notes');
        
        // é€‰é¡¹ç»„
        const statusOptions = document.getElementById('statusOptions');
        const shapeOptions = document.getElementById('shapeOptions');
        const eyeOptions = document.getElementById('eyeOptions');
        
        // å½“å‰é€‰ä¸­çš„å€¼
        let currentStatus = '';
        let currentShape = '';
        let currentEye = '';
        
        // åˆå§‹åŒ–
        function init() {
            // è®¾ç½®é»˜è®¤æ—¶é—´ä¸ºå½“å‰æ—¶é—´
            const now = new Date();
            startTime.value = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            
            // ä¸ºé€‰é¡¹æ·»åŠ ç‚¹å‡»äº‹ä»¶
            addOptionListeners(statusOptions, (value) => currentStatus = value);
            addOptionListeners(shapeOptions, (value) => currentShape = value);
            addOptionListeners(eyeOptions, (value) => currentEye = value);
            
            // å¯¼èˆªåˆ‡æ¢
            homeNav.addEventListener('click', () => showSection('home'));
            historyNav.addEventListener('click', () => showSection('history'));
            
            // æäº¤æŒ‰é’®
            submitBtn.addEventListener('click', handleSubmit);
            
            // æ¸…ç©ºå†å²æŒ‰é’®
            clearHistoryBtn.addEventListener('click', clearHistory);
            
            // åˆå§‹æ¸²æŸ“å†å²è®°å½•
            renderHistory();
        }
        
        // æ·»åŠ é€‰é¡¹ç‚¹å‡»äº‹ä»¶
        function addOptionListeners(container, callback) {
            const options = container.querySelectorAll('.option-card');
            options.forEach(option => {
                option.addEventListener('click', () => {
                    // ç§»é™¤å…¶ä»–é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
                    options.forEach(opt => opt.classList.remove('selected'));
                    // æ·»åŠ å½“å‰é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
                    option.classList.add('selected');
                    // å›è°ƒé€‰ä¸­çš„å€¼
                    callback(option.dataset.value);
                });
            });
        }
        
        // åˆ‡æ¢æ˜¾ç¤ºåŒºåŸŸ
        function showSection(section) {
            if (section === 'home') {
                homeSection.style.display = 'block';
                historySection.style.display = 'none';
                homeNav.classList.add('active');
                historyNav.classList.remove('active');
            } else {
                homeSection.style.display = 'none';
                historySection.style.display = 'block';
                homeNav.classList.remove('active');
                historyNav.classList.add('active');
                renderHistory();
            }
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            notificationText.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // ç”ŸæˆAIæ€»ç»“
        function generateAISummary() {
            if (records.length === 0) return;
            
            const lastRecords = records.slice(-3);
            const shapes = lastRecords.map(r => r.shape);
            const durations = lastRecords.map(r => parseInt(r.duration));
            const eyes = lastRecords.map(r => r.eye);
            
            // åˆ†æé¢‘ç‡
            const days = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            const today = new Date().getDay();
            const dayName = days[today];
            
            // åˆ†æå½¢çŠ¶
            const shapeCount = {};
            shapes.forEach(shape => {
                shapeCount[shape] = (shapeCount[shape] || 0) + 1;
            });
            const commonShape = Object.keys(shapeCount).sort((a, b) => shapeCount[b] - shapeCount[a])[0];
            
            // åˆ†ææ—¶é•¿
            const avgDuration = Math.round(durations.reduce((a, b) => a + b, 0) / durations.length);
            
            // åˆ†æçœ¼ç¥
            const eyeCount = {};
            eyes.forEach(eye => {
                eyeCount[eye] = (eyeCount[eye] || 0) + 1;
            });
            const commonEye = Object.keys(eyeCount).sort((a, b) => eyeCount[b] - eyeCount[a])[0];
            
            // ç”Ÿæˆæ€»ç»“
            let summary = `<p>æœ€è¿‘${lastRecords.length}æ¬¡æ‹‰å±è®°å½•åˆ†æï¼š</p>`;
            summary += `<p>ğŸ“… é¢‘ç‡ï¼š${lastRecords.length > 2 ? 'ç¨³å®š' : lastRecords.length > 1 ? 'å°šå¯' : 'ç¨€å°‘'}ï¼ˆæ˜ŸæœŸ${dayName}ç‰¹åˆ«æ´»è·ƒï¼‰</p>`;
            summary += `<p>ğŸ“Š å½¢çŠ¶ï¼š${commonShape || 'æš‚æ— æ•°æ®'}</p>`;
            summary += `<p>â±ï¸ å¹³å‡æ—¶é•¿ï¼š${avgDuration}åˆ†é’Ÿï¼ˆ${avgDuration > 20 ? 'å±äºæ²‰æµ¸å¼ä½“éªŒ' : avgDuration < 5 ? 'æ•ˆç‡æ´¾é€‰æ‰‹' : 'ä¸­è§„ä¸­çŸ©'}ï¼‰</p>`;
            summary += `<p>ğŸ‘€ å¸¸ç”¨çœ¼ç¥ï¼š${commonEye || 'æš‚æ— æ•°æ®'}</p>`;
            
            // ä¸ªæ€§åŒ–å»ºè®®
            let recommendation = '';
            if (avgDuration > 20) {
                recommendation = "ğŸ’¡ å»ºè®®ï¼šå‡å°‘åˆ·æ‰‹æœºæ—¶é—´ï¼Œè…¿éº»é£é™©è¾ƒé«˜";
            } else if (shapes.includes('ç¨€é‡Œå“—å•¦ï¼Œæ¥ä¸åŠå‘Šåˆ«')) {
                recommendation = "ğŸ’¡ å»ºè®®ï¼šæ³¨æ„é¥®é£Ÿå«ç”Ÿï¼Œå°‘åƒå¯ç–‘çƒ§çƒ¤";
            } else if (eyes.includes('çœ¼ç¥è­¦æƒ•ï¼ˆæ€•è¢«æ•²é—¨ï¼‰')) {
                recommendation = "ğŸ’¡ å»ºè®®ï¼šå®‰è£…å•æ‰€é—¨é”ï¼Œæå‡å®‰å…¨æ„Ÿ";
            } else {
                recommendation = "ğŸ’¡ å»ºè®®ï¼šä¿æŒå½“å‰çŠ¶æ€ï¼Œä½ åšå¾—å¾ˆå¥½ï¼";
            }
            
            aiSummaryContent.innerHTML = summary + `<div class="recommendation">${recommendation}</div>`;
            aiSummary.style.display = 'block';
        }
        
        // æäº¤è¡¨å•
        function handleSubmit() {
            // éªŒè¯å¿…å¡«é¡¹
            if (!currentStatus) {
                showNotification('è¯·å‘Šè¯‰æˆ‘ä½ æ‹‰æ²¡æ‹‰ï¼');
                return;
            }
            
            if (currentStatus === 'æ‹‰è¿‡äº†' && !currentShape) {
                showNotification('åˆ«å®³ç¾ï¼Œé€‰ä¸ªå±å½¢å§ï¼');
                return;
            }
            
            // æ”¶é›†æ•°æ®
            const record = {
                id: Date.now(),
                date: new Date().toLocaleDateString('zh-CN'),
                status: currentStatus,
                startTime: startTime.value || 'æœªçŸ¥æ—¶é—´',
                duration: duration.value || 'æœªçŸ¥',
                shape: currentShape || 'æ— ',
                eye: currentEye || 'æ— ',
                notes: notes.value || 'æ— ',
                timestamp: new Date().toISOString()
            };
            
            // ä¿å­˜åˆ°localStorage
            records.push(record);
            localStorage.setItem('laleRecords', JSON.stringify(records));
            
            // æ˜¾ç¤ºæˆåŠŸé€šçŸ¥
            showNotification('è®°å½•æˆåŠŸï¼åˆæ˜¯ä¸€æ¡å¥½æ±‰ï¼');
            
            // ç”ŸæˆAIæ€»ç»“ï¼ˆå¦‚æœæœ‰3æ¡ä»¥ä¸Šè®°å½•ï¼‰
            if (records.length >= 3) {
                generateAISummary();
            }
            
            // é‡ç½®è¡¨å•ï¼ˆä¿ç•™çŠ¶æ€é€‰é¡¹ï¼‰
            resetForm();
        }
        
        // é‡ç½®è¡¨å•
        function resetForm() {
            // é‡ç½®é€‰é¡¹
            document.querySelectorAll('.option-card').forEach(opt => opt.classList.remove('selected'));
            currentStatus = '';
            currentShape = '';
            currentEye = '';
            
            // é‡ç½®è¾“å…¥æ¡†
            duration.value = '';
            notes.value = '';
            
            // éšè—AIæ€»ç»“
            aiSummary.style.display = 'none';
        }
        
        // æ¸²æŸ“å†å²è®°å½•
        function renderHistory() {
            if (records.length === 0) {
                historyList.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            // æŒ‰æ—¶é—´å€’åºæ’åˆ—
            const sortedRecords = [...records].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            historyList.innerHTML = sortedRecords.map(record => `
                <div class="history-item">
                    <div class="history-header">
                        <span>${record.date}</span>
                        <span>${record.status}</span>
                    </div>
                    <div class="history-details">
                        <div class="history-detail">
                            <i class="fas fa-clock"></i> ${record.startTime}
                        </div>
                        <div class="history-detail">
                            <i class="fas fa-hourglass-half"></i> ${record.duration}åˆ†é’Ÿ
                        </div>
                        <div class="history-detail">
                            <i class="fas fa-toilet"></i> ${record.shape}
                        </div>
                        <div class="history-detail">
                            <i class="fas fa-eye"></i> ${record.eye}
                        </div>
                    </div>
                    ${record.notes !== 'æ— ' ? `<div style="margin-top:10px; font-style:italic; color:#8B4513;">"${record.notes}"</div>` : ''}
                </div>
            `).join('');
        }
        
        // æ¸…ç©ºå†å²è®°å½•
        function clearHistory() {
            if (records.length === 0) return;
            
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ‹‰å±å›å¿†å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                records = [];
                localStorage.removeItem('laleRecords');
                renderHistory();
                showNotification('å›å¿†å·²æ¸…ç©ºï¼Œé‡æ–°å¼€å§‹å§ï¼');
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
